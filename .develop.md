# Flowersec 开发规范

> 目标：让开发与 CI 对齐、避免在 `main` 上直接开发、避免把临时文档/草稿提交进仓库。

---

## 0. Git 开发模式（Worktree，强制）

- 本仓库永远不在 `main` 分支上直接开发：`main` 只做同步（`pull --ff-only`）与合并（merge）。
- feature 开发：一个 feature = 一个 worktree 目录 + 一个分支；目录放在父目录，命名统一使用 `../flowersec-feat-<topic>`，分支命名统一使用 `feat-<topic>`。

模板：

```bash
git fetch origin
git switch main
git pull --ff-only

BR=feat-<topic>
WT=../flowersec-feat-<topic>
git worktree add -b "$BR" "$WT" origin/main
```

开发完成后合并回 `main` 并清理 worktree/分支：

```bash
git switch main
git pull --ff-only
git merge --no-ff "$BR"
git push origin main

git worktree remove "$WT"
git branch -d "$BR"
```

---

## 1. 开发过程临时文档（不入库，完成后删除）

- 开发过程中允许编写临时文档（需求拆解、问题分析、落地方案、checklist 等），用于推进协作与保证质量。
- 这些临时文档 **不得提交到代码库**：
  - 推荐放在仓库外（最省心，不会污染目录结构）。
  - 若必须放在仓库内：必须落在 `.gitignore` 覆盖的路径下，且在合并前确保 `git status` 不会出现它们。
- 当 feature 开发完成并合并后，必须随手删除这些临时文档，避免长期堆积“历史草稿”导致误导与泄露风险。

---

## 2. 提交前本地质量门禁（必须执行）

- 单一事实来源：以 CI 为准；本地至少跑通 `make check`（仓库根目录 `Makefile` 已收敛）。
- `make check` 会覆盖：
  - Go：fmt/lint/test/race/vulncheck
  - TS：npm ci/lint/test/build/audit
  - IDL codegen：gen-check（防止忘记提交生成产物）

---

## 3. Release / Tag 规则

- Go SDK（`flowersec-go`）发布使用 tag：`flowersec-go/v<version>`（例如 `flowersec-go/v0.9.0`）。
- 当下游仓库需要新能力时，优先 upstream-first：先在本仓库完成实现与门禁 → 合并到 `main` → 打 tag 并 push → 确认发布成功 → 再到下游升级依赖。

