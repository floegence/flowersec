// Code generated by idlgen. DO NOT EDIT.

import type { RpcCaller } from "../../../rpc/caller.js";
import { RpcCallError } from "../../../rpc/callError.js";
import {
  HelloNotify,
  PingRequest,
  PingResponse,
  assertHelloNotify,
  assertPingRequest,
  assertPingResponse,
} from "./v1.gen.js";

/** Demo service used by examples and integration tests. */
export function createDemoClient(rpc: RpcCaller) {
  return {
    /** Hello notification. */
    onHello: (handler: (v: HelloNotify) => void) => {
      return rpc.onNotify(2, (payload) => {
        handler(assertHelloNotify(payload));
      });
    },
    /** Ping request/response. */
    ping: async (req: PingRequest, opts: Readonly<{ signal?: AbortSignal }> = {}) => {
      const checkedReq = assertPingRequest(req);
      const resp = await rpc.call(1, checkedReq, opts.signal);
      if (resp.error != null) throw new RpcCallError(resp.error.code, resp.error.message, 1);
      return assertPingResponse(resp.payload);
    },
  };
}

