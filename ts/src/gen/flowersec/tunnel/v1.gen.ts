// Code generated by idlgen. DO NOT EDIT.

/** Endpoint role for tunnel attach. */
export enum Role {
  /** Client endpoint. */
  Role_client = 1,
  /** Server endpoint. */
  Role_server = 2,
}

/** Tunnel attach request payload. */
export interface Attach {
  /** Attach envelope version. */
  v: number;
  /** Channel identifier. */
  channel_id: string;
  /** Endpoint role. */
  role: Role;
  /** Signed attach token. */
  token: string;
  /** Base64url-encoded endpoint instance ID. */
  endpoint_instance_id: string;
  /** Optional capability map. */
  caps?: Record<string, string>;
}

function isRecord(v: unknown): v is Record<string, unknown> {
  return typeof v === "object" && v != null && !Array.isArray(v);
}

function assertString(name: string, v: unknown): string {
  if (typeof v !== "string") throw new Error(`bad ${name}`);
  return v;
}

function assertBoolean(name: string, v: unknown): boolean {
  if (typeof v !== "boolean") throw new Error(`bad ${name}`);
  return v;
}

function assertSafeInt(name: string, v: unknown): number {
  if (typeof v !== "number" || !Number.isSafeInteger(v)) throw new Error(`bad ${name}`);
  return v;
}

function assertU32(name: string, v: unknown): number {
  const n = assertSafeInt(name, v);
  if (n < 0 || n > 0xffffffff) throw new Error(`bad ${name}`);
  return n;
}

function assertU16(name: string, v: unknown): number {
  const n = assertU32(name, v);
  if (n > 0xffff) throw new Error(`bad ${name}`);
  return n;
}

function assertU8(name: string, v: unknown): number {
  const n = assertU32(name, v);
  if (n > 0xff) throw new Error(`bad ${name}`);
  return n;
}

function assertU64(name: string, v: unknown): number {
  const n = assertSafeInt(name, v);
  if (n < 0) throw new Error(`bad ${name}`);
  return n;
}

function assertI32(name: string, v: unknown): number {
  const n = assertSafeInt(name, v);
  if (n < -2147483648 || n > 2147483647) throw new Error(`bad ${name}`);
  return n;
}

function assertI64(name: string, v: unknown): number {
  return assertSafeInt(name, v);
}

function assertStringMap(name: string, v: unknown): Record<string, string> {
  if (!isRecord(v)) throw new Error(`bad ${name}`);
  for (const [k, vv] of Object.entries(v)) {
    void k;
    if (typeof vv !== "string") throw new Error(`bad ${name}`);
  }
  return v as Record<string, string>;
}

const _RoleValues = new Set<number>([
  1,
  2,
]);

function assertRole(name: string, v: unknown): Role {
  const n = assertSafeInt(name, v);
  if (!_RoleValues.has(n)) throw new Error(`bad ${name}`);
  return n as Role;
}

export function assertAttach(v: unknown): Attach {
  if (!isRecord(v)) throw new Error("bad Attach");
  const o = v as Record<string, unknown>;
  if (o["v"] === undefined) throw new Error("bad Attach.v");
  assertU32("Attach.v", o["v"]);
  if (o["channel_id"] === undefined) throw new Error("bad Attach.channel_id");
  assertString("Attach.channel_id", o["channel_id"]);
  if (o["role"] === undefined) throw new Error("bad Attach.role");
  assertRole("Attach.role", o["role"]);
  if (o["token"] === undefined) throw new Error("bad Attach.token");
  assertString("Attach.token", o["token"]);
  if (o["endpoint_instance_id"] === undefined) throw new Error("bad Attach.endpoint_instance_id");
  assertString("Attach.endpoint_instance_id", o["endpoint_instance_id"]);
  if (o["caps"] !== undefined) {
    assertStringMap("Attach.caps", o["caps"]);
  }
  return o as unknown as Attach;
}

