{
  "namespace": "flowersec.e2ee.v1",
  "enums": {
    "Role": {
      "comment": "Endpoint role for the E2EE handshake.",
      "type": "u8",
      "values": { "client": 1, "server": 2 },
      "value_comments": {
        "client": "Client endpoint.",
        "server": "Server endpoint."
      }
    },
    "Suite": {
      "comment": "E2EE cipher suite identifier.",
      "type": "u16",
      "values": {
        "X25519_HKDF_SHA256_AES_256_GCM": 1,
        "P256_HKDF_SHA256_AES_256_GCM": 2
      },
      "value_comments": {
        "X25519_HKDF_SHA256_AES_256_GCM": "X25519 + HKDF-SHA256 + AES-256-GCM.",
        "P256_HKDF_SHA256_AES_256_GCM": "P-256 + HKDF-SHA256 + AES-256-GCM."
      }
    },
    "RecordFlags": {
      "comment": "Record type indicator for encrypted frames.",
      "type": "u8",
      "values": { "app": 0, "ping": 1, "rekey": 2 },
      "value_comments": {
        "app": "Application data record.",
        "ping": "Ping record.",
        "rekey": "Rekey control record."
      }
    },
    "E2EEFeatureBits": {
      "comment": "Feature bitset advertised during handshake.",
      "type": "u32",
      "values": { "rekey": 1 },
      "value_comments": {
        "rekey": "Supports rekey control records."
      }
    }
  },
  "messages": {
    "E2EE_Init": {
      "comment": "Client handshake init payload.",
      "fields": [
        { "name": "channel_id", "type": "string", "comment": "Channel identifier." },
        { "name": "role", "type": "Role", "comment": "Role of the sender (client)." },
        { "name": "version", "type": "u8", "comment": "Protocol version." },
        { "name": "suite", "type": "Suite", "comment": "Requested cipher suite." },
        { "name": "client_eph_pub_b64u", "type": "string", "comment": "Base64url-encoded client ephemeral public key." },
        { "name": "nonce_c_b64u", "type": "string", "comment": "Base64url-encoded client nonce (32 bytes)." },
        { "name": "client_features", "type": "u32", "comment": "Client feature bits." }
      ]
    },
    "E2EE_Resp": {
      "comment": "Server handshake response payload.",
      "fields": [
        { "name": "handshake_id", "type": "string", "comment": "Handshake identifier for retries." },
        { "name": "server_eph_pub_b64u", "type": "string", "comment": "Base64url-encoded server ephemeral public key." },
        { "name": "nonce_s_b64u", "type": "string", "comment": "Base64url-encoded server nonce (32 bytes)." },
        { "name": "server_features", "type": "u32", "comment": "Server feature bits." }
      ]
    },
    "E2EE_Ack": {
      "comment": "Client handshake ack payload.",
      "fields": [
        { "name": "handshake_id", "type": "string", "comment": "Handshake identifier being acknowledged." },
        { "name": "timestamp_unix_s", "type": "u64", "comment": "Client Unix timestamp used for the auth tag." },
        { "name": "auth_tag_b64u", "type": "string", "comment": "Base64url-encoded auth tag." }
      ]
    }
  }
}
